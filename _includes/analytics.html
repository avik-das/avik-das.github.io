{% if jekyll.environment == "production" %}
<script async>
  // Track a single visit to the current page. The Javascript below is left
  // unobfuscated to show exactly what is being tracked:
  //
  // - Which page the visit happened on.
  // - Where the visit originated from.
  //
  // Feel free to block this script. My goal is just to understand how much
  // traffic I'm getting and where I'm getting it from. For example, with
  // uBlock Origin's inline script filtering, you can block the script based on
  // the following unique string:
  //
  //   blockable-analytics

  const payload = {
    // Note: use the server-side generated path, instead of reading the path
    // from the browser. This is important because the Pocket app
    // (https://getpocket.com/) embeds web pages into the app, and the browser
    // reports the current URL incorrectly.
    path: '{{ page.url }}',
    source: document.referrer
  };

  fetch(
    'https://analytics.avikdas.com:1443/track_visit',
    {
      method: 'POST',
      mode: 'cors',
      cache: 'no-cache',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    }
  );
</script>
{% endif %}
